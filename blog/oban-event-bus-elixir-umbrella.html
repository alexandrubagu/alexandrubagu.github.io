<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Oban as an Event Bus: Decoupled Communication in Elixir Umbrella Apps - Bâgu Alexandru Bogdan</title>
  <meta name="description" content="Learn how to use Oban as an event bus for loose coupling in Elixir umbrella projects. Master async communication patterns, job queues, and event-driven architecture with practical examples." />

  <!-- PWA and Mobile -->
  <meta name="theme-color" content="#1e293b">

  <!-- JSON-LD Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "Oban as an Event Bus: Decoupled Communication in Elixir Umbrella Apps",
    "description": "Learn how to use Oban as an event bus for loose coupling in Elixir umbrella projects. Master async communication patterns, job queues, and event-driven architecture with practical examples.",
    "image": "https://alexandrubagu.github.io/profile.jpg",
    "author": {
      "@type": "Person",
      "name": "Bâgu Alexandru Bogdan",
      "url": "https://alexandrubagu.github.io"
    },
    "publisher": {
      "@type": "Person",
      "name": "Bâgu Alexandru Bogdan",
      "logo": {
        "@type": "ImageObject",
        "url": "https://alexandrubagu.github.io/profile.jpg"
      }
    },
    "datePublished": "2026-01-05T12:00:00+08:00",
    "dateModified": "2026-01-05T12:00:00+08:00",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://alexandrubagu.github.io/blog/oban-event-bus-elixir-umbrella.html"
    },
    "keywords": "Oban event bus, Elixir umbrella projects, loose coupling, async communication, event-driven architecture, Oban job queue, microservices pattern, Elixir architecture, message broker, decoupled applications",
    "articleSection": "Elixir Development",
    "inLanguage": "en-US",
    "about": [
      {
        "@type": "Thing",
        "name": "Event-Driven Architecture"
      },
      {
        "@type": "Thing",
        "name": "Oban Job Queue"
      },
      {
        "@type": "Thing",
        "name": "Elixir Umbrella Projects"
      },
      {
        "@type": "Thing",
        "name": "Microservices Patterns"
      }
    ]
  }
  </script>

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "TechArticle",
    "name": "Oban Event Bus Implementation Guide",
    "description": "Complete guide to using Oban as an event bus for decoupled communication in Elixir umbrella applications",
    "proficiencyLevel": "Intermediate",
    "dependencies": "Elixir ~> 1.12, Oban ~> 2.14, Ecto ~> 3.6, PostgreSQL",
    "author": {
      "@type": "Person",
      "name": "Bâgu Alexandru Bogdan"
    }
  }
  </script>

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "HowTo",
    "name": "How to Implement Oban as an Event Bus",
    "description": "Step-by-step guide to implementing loose coupling with Oban in Elixir umbrella projects",
    "step": [
      {
        "@type": "HowToStep",
        "name": "Setup Shared Persistence Layer",
        "text": "Create a shared persistence application with Ecto.Repo for Oban job storage"
      },
      {
        "@type": "HowToStep",
        "name": "Configure Oban Instances",
        "text": "Set up independent Oban instances for each application sharing the same database"
      },
      {
        "@type": "HowToStep",
        "name": "Implement Worker Modules",
        "text": "Create worker modules in each application to process jobs asynchronously"
      },
      {
        "@type": "HowToStep",
        "name": "Enable Cross-App Communication",
        "text": "Use Oban.Job.new to create jobs for workers in other applications without direct dependencies"
      }
    ]
  }
  </script>

  <!-- Performance optimizations -->
  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="dns-prefetch" href="https://cdn.tailwindcss.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
          colors: {
            primary: 'rgb(59, 130, 246)',
            'primary-foreground': 'rgb(255, 255, 255)',
            background: 'rgb(255, 255, 255)',
            foreground: 'rgb(30, 41, 59)',
            muted: 'rgb(241, 245, 249)',
            'muted-foreground': 'rgb(100, 116, 139)',
            border: 'rgb(226, 232, 240)',
            slate: {
              50: 'rgb(248, 250, 252)',
              100: 'rgb(241, 245, 249)',
              200: 'rgb(226, 232, 240)',
              300: 'rgb(203, 213, 225)',
              400: 'rgb(148, 163, 184)',
              500: 'rgb(100, 116, 139)',
              600: 'rgb(71, 85, 105)',
              700: 'rgb(51, 65, 85)',
              800: 'rgb(30, 41, 59)',
              900: 'rgb(15, 23, 42)',
            },
          },
        },
      },
    }
  </script>

  <style>
    html {
      scroll-behavior: smooth;
    }

    section {
      scroll-margin-top: 5rem;
    }

    .gradient-hero {
      background: linear-gradient(135deg, rgb(15, 23, 42) 0%, rgb(30, 41, 59) 100%);
    }

    .gradient-primary {
      background: linear-gradient(135deg, rgb(59, 130, 246) 0%, rgb(96, 165, 250) 100%);
    }

    .gradient-subtle {
      background: linear-gradient(180deg, rgb(255, 255, 255) 0%, rgb(248, 250, 252) 100%);
    }

    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .line-clamp-3 {
      display: -webkit-box;
      -webkit-line-clamp: 3;
      line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    article code {
      background-color: #f1f5f9;
      padding: 0.125rem 0.5rem;
      border-radius: 0.25rem;
      font-size: 0.875rem;
    }

    article pre {
      background-color: #1e293b;
      color: #e2e8f0;
      padding: 1rem;
      border-radius: 0.5rem;
      overflow-x: auto;
      margin-bottom: 1rem;
    }

    article pre code {
      background-color: transparent;
      padding: 0;
      color: #e2e8f0;
      font-family: 'Courier New', monospace;
    }

    article h2 {
      font-size: 1.875rem;
      font-weight: 700;
      margin-top: 2rem;
      margin-bottom: 1rem;
      color: #1e293b;
    }

    article h3 {
      font-size: 1.5rem;
      font-weight: 600;
      margin-top: 1.5rem;
      margin-bottom: 0.75rem;
      color: #334155;
    }

    article h4 {
      font-size: 1.25rem;
      font-weight: 600;
      margin-top: 1.25rem;
      margin-bottom: 0.5rem;
      color: #475569;
    }

    article p {
      margin-bottom: 1rem;
      line-height: 1.75;
      color: #475569;
    }

    article ul, article ol {
      margin-left: 1.5rem;
      margin-bottom: 1rem;
    }

    article li {
      margin-bottom: 0.5rem;
      color: #475569;
      line-height: 1.75;
    }

    article strong {
      color: #1e293b;
      font-weight: 600;
    }
  </style>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-WK8MJ0B6R6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-WK8MJ0B6R6');
  </script>
</head>
<body class="bg-white text-slate-900">
  <!-- Navigation -->
  <nav id="navbar" class="fixed top-0 left-0 right-0 z-50 bg-white/95 backdrop-blur-md shadow-md transition-all duration-300">
    <div class="container mx-auto px-4">
      <div class="flex items-center justify-between h-16">
        <a href="/index.html" id="navbar-logo" class="text-xl font-bold text-slate-900 hover:text-primary transition-colors">
          Alexandru Bogdan
        </a>

        <!-- Desktop Navigation -->
        <div class="hidden md:flex items-center space-x-1" id="desktop-nav">
          <a href="/index.html#home" class="px-3 py-2 text-sm font-medium text-slate-900 hover:text-primary transition-colors">Home</a>
          <a href="/index.html#experience" class="px-3 py-2 text-sm font-medium text-slate-900 hover:text-primary transition-colors">Experience</a>
          <a href="/index.html#projects" class="px-3 py-2 text-sm font-medium text-slate-900 hover:text-primary transition-colors">Projects</a>
          <a href="/blog.html" class="px-3 py-2 text-sm font-medium text-slate-900 hover:text-primary transition-colors">Blog</a>
          <a href="/index.html#contact" class="px-3 py-2 text-sm font-medium text-slate-900 hover:text-primary transition-colors">Contact</a>
        </div>

        <!-- Mobile Menu Button -->
        <button id="mobile-menu-btn" class="md:hidden p-2 text-slate-900">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>

      <!-- Mobile Navigation -->
      <div id="mobile-menu" class="hidden md:hidden py-4 border-t border-slate-200">
        <div class="flex flex-col space-y-2" id="mobile-nav">
          <a href="/index.html#home" class="px-3 py-2 text-sm font-medium text-slate-900 hover:text-primary hover:bg-slate-100 rounded-md transition-colors">Home</a>
          <a href="/index.html#experience" class="px-3 py-2 text-sm font-medium text-slate-900 hover:text-primary hover:bg-slate-100 rounded-md transition-colors">Experience</a>
          <a href="/index.html#projects" class="px-3 py-2 text-sm font-medium text-slate-900 hover:text-primary hover:bg-slate-100 rounded-md transition-colors">Projects</a>
          <a href="/blog.html" class="px-3 py-2 text-sm font-medium text-slate-900 hover:text-primary hover:bg-slate-100 rounded-md transition-colors">Blog</a>
          <a href="/index.html#contact" class="px-3 py-2 text-sm font-medium text-slate-900 hover:text-primary hover:bg-slate-100 rounded-md transition-colors">Contact</a>
        </div>
      </div>
    </div>
  </nav>

  <article class="container mx-auto px-4 pt-24 pb-16">
    <div class="max-w-3xl mx-auto">
      <header class="mb-12">
        <div class="flex items-center gap-2 mb-4">
          <span class="px-3 py-1 bg-slate-200 text-slate-700 text-sm rounded-full">Elixir</span>
          <span class="text-sm text-slate-600">15 min read</span>
        </div>
        <h1 class="text-4xl md:text-5xl font-bold mb-4 text-slate-900">Oban as an Event Bus: Decoupled Communication in Elixir Umbrella Apps</h1>
        <div class="flex items-center gap-2 text-slate-600">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
          </svg>
          January 5, 2026
        </div>
      </header>

      <h2>Overview</h2>
      <p>This project demonstrates an architectural pattern for achieving <strong>loose coupling</strong> between applications in an Elixir umbrella project using <strong>Oban as an event bus</strong>. The key insight is that applications can communicate asynchronously without having compile-time dependencies on each other, creating clear boundaries while maintaining flexibility.</p>

      <h2>The Problem</h2>
      <p>In traditional umbrella architectures, when AppA needs to trigger functionality in AppB, it typically:</p>
      <ol>
        <li><strong>Adds AppB as a dependency</strong> in <code>mix.exs</code></li>
        <li><strong>Directly calls</strong> AppB's functions</li>
        <li><strong>Creates tight coupling</strong> between the applications</li>
      </ol>

      <p>This approach has several drawbacks:</p>
      <ul>
        <li>Circular dependency issues when AppB also needs to call AppA</li>
        <li>Difficult to independently deploy or extract applications</li>
        <li>Hard to maintain clear boundaries as the codebase grows</li>
        <li>Synchronous communication can lead to cascading failures</li>
        <li>Testing becomes more complex due to tight coupling</li>
      </ul>

      <h2>The Solution: Oban as an Event Bus</h2>
      <p>This project solves these problems by using <strong>Oban as a message broker/event bus</strong> that sits between applications. Applications communicate by:</p>
      <ol>
        <li><strong>Creating jobs</strong> for workers in other applications</li>
        <li><strong>Storing jobs</strong> in a shared database via Oban</li>
        <li><strong>Processing jobs</strong> asynchronously by the target application's worker</li>
      </ol>

      <h3>Key Principle</h3>
      <p><strong>AppA and AppB don't know about each other at compile time</strong> - they only share:</p>
      <ul>
        <li>A common persistence layer (<code>Persistence.Repo</code>)</li>
        <li>The Oban library</li>
        <li>Knowledge of worker module names (as strings/atoms)</li>
      </ul>

      <h2>Architecture Diagram</h2>
      <pre><code>┌─────────────────────────────────────────────────────────────────────┐
│  AppA and AppB don't know each other                                │
└─────────────────────────────────────────────────────────────────────┘

┌──────────────────┐                                 ┌──────────────────┐
│      AppA        │                                 │      AppB        │
│                  │                                 │                  │
│  ┌────────────┐  │                                 │  ┌────────────┐  │
│  │  WorkerA   │  │                                 │  │  WorkerB   │  │
│  └────────────┘  │                                 │  └────────────┘  │
└────────┬─────────┘                                 └────────┬─────────┘
         │                                                     │
         │ Creates job for WorkerB                            │ Creates job for WorkerA
         │                                                     │
         ▼                                                     ▼
    ┌────────────────────────────────────────────────────────────┐
    │  Oban.Job.new(                    Oban.Job.new(            │
    │    params,                          params,                │
    │    queue: :default,                 queue: :default,       │
    │    worker: AppB.Worker)             worker: AppA.Worker)   │
    └────────────────────────────────────────────────────────────┘
         │                                                     │
         └──────────────────┬──────────────────────────────────┘
                           ▼
                  ┌─────────────────┐
                  │      Oban       │
                  │  (Job Queue)    │
                  │                 │
                  │  Shared via     │
                  │  Persistence    │
                  │  Layer          │
                  └─────────────────┘
                           │
         ┌─────────────────┴──────────────────┐
         │                                     │
         ▼                                     ▼
┌──────────────────┐                 ┌──────────────────┐
│ Calls WorkerA    │                 │ Calls WorkerB    │
│ with params      │                 │ with params      │
│ from WorkerB     │                 │ from WorkerA     │
└──────────────────┘                 └──────────────────┘</code></pre>

      <h2>Project Structure</h2>
      <pre><code>oban_test_umbrella/
├── apps/
│   ├── app_a/                    # First application
│   │   ├── lib/
│   │   │   ├── app_a/
│   │   │   │   ├── application.ex   # Starts Oban for AppA
│   │   │   │   └── worker.ex        # AppA.Worker - processes jobs
│   │   └── mix.exs               # Only depends on :persistence & :oban
│   │
│   ├── app_b/                    # Second application
│   │   ├── lib/
│   │   │   ├── app_b/
│   │   │   │   ├── application.ex   # Starts Oban for AppB
│   │   │   │   └── worker.ex        # AppB.Worker - processes jobs
│   │   └── mix.exs               # Only depends on :persistence & :oban
│   │
│   └── persistence/              # Shared persistence layer
│       ├── lib/
│       │   ├── persistence/
│       │   │   ├── application.ex   # Starts Repo
│       │   │   └── repo.ex          # Shared Ecto.Repo
│       ├── priv/repo/migrations/
│       │   └── *_add_oban_jobs_table.exs
│       └── mix.exs               # Depends on :ecto_sql & :postgrex
│
├── config/
│   ├── config.exs                # Configures Oban instances & Repo
│   └── dev.exs                   # Database credentials
│
└── diagram/
    └── oban.drawio.png           # Architecture visualization</code></pre>

      <h2>Implementation Details</h2>

      <h3>1. Dependency Configuration</h3>

      <h4>AppA (<code>apps/app_a/mix.exs</code>)</h4>
      <pre><code>defp deps do
  [
    {:persistence, in_umbrella: true},  # Shared database layer
    {:oban, "~> 2.14"}                  # Job processing
    # NOTE: No dependency on :app_b!
  ]
end</code></pre>

      <h4>AppB (<code>apps/app_b/mix.exs</code>)</h4>
      <pre><code>defp deps do
  [
    {:persistence, in_umbrella: true},  # Shared database layer
    {:oban, "~> 2.14"}                  # Job processing
    # NOTE: No dependency on :app_a!
  ]
end</code></pre>

      <h4>Persistence (<code>apps/persistence/mix.exs</code>)</h4>
      <pre><code>defp deps do
  [
    {:postgrex, ">= 0.0.0"},
    {:ecto_sql, "~> 3.6"}
  ]
end</code></pre>

      <h3>2. Oban Configuration</h3>
      <p>Each application gets its own Oban instance, but they share the same database:</p>
      <pre><code># config/config.exs
config :app_a, Oban,
  name: AppA.Oban,           # Unique Oban instance name
  repo: Persistence.Repo,    # Shared repository
  queues: [default: 10]      # Queue configuration

config :app_b, Oban,
  name: AppB.Oban,           # Different instance name
  repo: Persistence.Repo,    # Same shared repository
  queues: [default: 10]</code></pre>

      <h3>3. Application Supervision</h3>
      <p>Each app starts its own Oban instance:</p>

      <h4>AppA.Application</h4>
      <pre><code>def start(_type, _args) do
  children = [
    {Oban, Application.fetch_env!(:app_a, Oban)}
  ]

  opts = [strategy: :one_for_one, name: AppA.Supervisor]
  Supervisor.start_link(children, opts)
end</code></pre>

      <h4>AppB.Application</h4>
      <pre><code>def start(_type, _args) do
  children = [
    {Oban, Application.fetch_env!(:app_b, Oban)}
  ]

  opts = [strategy: :one_for_one, name: AppB.Supervisor]
  Supervisor.start_link(children, opts)
end</code></pre>

      <h3>4. Cross-App Communication</h3>

      <h4>AppA.Worker</h4>
      <pre><code>defmodule AppA.Worker do
  use Oban.Worker, queue: :default
  require Logger

  @impl Oban.Worker
  def perform(%Oban.Job{args: %{"number" => number}}) do
    Logger.info("[WorkerA] I got #{number}")

    # Simulate some work
    Process.sleep(Enum.random(100..1000))

    # Create a job for AppB.Worker (if number < 100)
    if number < 100 do
      job = Oban.Job.new(
        %{number: number + 1},
        queue: :default,
        worker: AppB.Worker  # Reference by module name
      )
      Oban.insert(AppA.Oban, job)
    end

    :ok
  end
end</code></pre>

      <h4>AppB.Worker</h4>
      <pre><code>defmodule AppB.Worker do
  use Oban.Worker, queue: :default
  require Logger

  @impl Oban.Worker
  def perform(%Oban.Job{args: %{"number" => number}}) do
    Logger.info("[WorkerB] I got #{number}")

    # Simulate some work
    Process.sleep(Enum.random(100..1000))

    # Create a job for AppA.Worker
    job = Oban.Job.new(
      %{"number" => number + 1},
      queue: :default,
      worker: AppA.Worker  # Reference by module name
    )
    Oban.insert(AppB.Oban, job)

    :ok
  end
end</code></pre>

      <h3>5. Initiating the Flow</h3>
      <pre><code># In AppA.Application
def start(number) do
  job = AppA.Worker.new(%{number: number})
  Oban.insert(AppA.Oban, job)
  :ok
end</code></pre>

      <h2>How It Works</h2>

      <h3>The Ping-Pong Flow</h3>
      <ol>
        <li><strong>Start</strong>: Call <code>AppA.Application.start(1)</code> from IEx</li>
        <li><strong>AppA processes job</strong>: WorkerA receives number=1</li>
        <li><strong>AppA creates job</strong>: WorkerA creates a job for WorkerB with number=2</li>
        <li><strong>Job stored</strong>: Oban saves the job to the shared database</li>
        <li><strong>AppB processes job</strong>: WorkerB picks up the job and receives number=2</li>
        <li><strong>AppB creates job</strong>: WorkerB creates a job for WorkerA with number=3</li>
        <li><strong>Repeat</strong>: This ping-pong continues until number reaches 100</li>
      </ol>

      <h2>Benefits of This Architecture</h2>

      <h3>1. Loose Coupling</h3>
      <ul>
        <li>Applications don't depend on each other in <code>mix.exs</code></li>
        <li>Can be developed and tested independently</li>
        <li>Easier to extract into separate repositories if needed</li>
      </ul>

      <h3>2. Clear Boundaries</h3>
      <ul>
        <li>Communication happens through well-defined job contracts</li>
        <li>Each app only knows about job schemas, not implementation details</li>
        <li>Easier to reason about system boundaries</li>
      </ul>

      <h3>3. Asynchronous by Default</h3>
      <ul>
        <li>No blocking calls between applications</li>
        <li>Better fault isolation (if AppB crashes, AppA continues)</li>
        <li>Natural backpressure through queue depth</li>
      </ul>

      <h3>4. Scalability</h3>
      <ul>
        <li>Can scale Oban workers independently per application</li>
        <li>Database provides natural coordination</li>
        <li>Can run multiple instances of each app</li>
      </ul>

      <h3>5. Testability</h3>
      <ul>
        <li>Can test each worker in isolation</li>
        <li>Easy to mock job creation</li>
        <li>Can test cross-app flows by inspecting Oban jobs in tests</li>
      </ul>

      <h3>6. Flexibility</h3>
      <ul>
        <li>Easy to add new applications that participate in the event bus</li>
        <li>Can change worker implementations without affecting other apps</li>
        <li>Can add event transformations, routing, or middleware</li>
      </ul>

      <h3>7. Observability</h3>
      <ul>
        <li>All communication is visible in the database</li>
        <li>Can inspect, retry, or cancel jobs</li>
        <li>Oban provides built-in metrics and monitoring</li>
      </ul>

      <h2>Trade-offs and Considerations</h2>

      <h3>Advantages</h3>
      <ul>
        <li><strong>Decoupling</strong>: True independence between applications</li>
        <li><strong>Resilience</strong>: Async communication provides fault tolerance</li>
        <li><strong>Flexibility</strong>: Easy to add new apps or change implementations</li>
        <li><strong>Database-backed</strong>: Reliable, durable job storage</li>
      </ul>

      <h3>Disadvantages</h3>
      <ul>
        <li><strong>Latency</strong>: Not suitable for synchronous requirements</li>
        <li><strong>Database Load</strong>: All communication goes through database</li>
        <li><strong>Debugging</strong>: Async flows can be harder to trace</li>
      </ul>

      <h3>When to Use This Pattern</h3>
      <p><strong>Good fit for:</strong></p>
      <ul>
        <li>Microservices-style architecture within a monorepo</li>
        <li>Event-driven workflows</li>
        <li>Background processing and async tasks</li>
        <li>Applications with different deployment cycles</li>
        <li>Systems requiring high availability</li>
      </ul>

      <p><strong>Not ideal for:</strong></p>
      <ul>
        <li>Low-latency, synchronous operations</li>
        <li>Simple, tightly coupled features</li>
      </ul>

      <h2>Running the Project</h2>

      <h3>Setup</h3>
      <ol>
        <li><strong>Install dependencies</strong>:
          <pre><code>mix deps.get</code></pre>
        </li>
        <li><strong>Setup database</strong>:
          <pre><code>mix do ecto.drop, ecto.create, ecto.migrate</code></pre>
        </li>
        <li><strong>Start IEx</strong>:
          <pre><code>iex -S mix</code></pre>
        </li>
      </ol>

      <h3>Testing the Flow</h3>
      <p>Start the ping-pong job flow:</p>
      <pre><code>iex> AppA.Application.start(1)
:ok</code></pre>

      <p>You'll see output like:</p>
      <pre><code>[info] [2024-01-05 10:30:15.123][WorkerA] I got 1
[info] [2024-01-05 10:30:15.456][WorkerB] I got 2
[info] [2024-01-05 10:30:15.789][WorkerA] I got 3
[info] [2024-01-05 10:30:16.012][WorkerB] I got 4
...
[info] [2024-01-05 10:30:25.345][WorkerA] I got 99
[info] [2024-01-05 10:30:25.678][WorkerB] I got 100</code></pre>

      <h3>Inspecting Jobs</h3>
      <p>You can query Oban jobs directly:</p>
      <pre><code>iex> Persistence.Repo.all(Oban.Job)
# See all jobs in the system

iex> import Ecto.Query
iex> Persistence.Repo.all(from j in Oban.Job, where: j.state == "available")
# See pending jobs</code></pre>

      <h2>Advanced Patterns</h2>

      <h3>1. Event Types</h3>
      <p>Instead of referencing workers directly, you could use a convention:</p>
      <pre><code># Define event types
job = Oban.Job.new(
  %{event: "user.registered", user_id: 123},
  queue: :events,
  worker: EventDispatcher.Worker
)

# EventDispatcher routes to appropriate handlers
defmodule EventDispatcher.Worker do
  def perform(%{args: %{"event" => "user.registered"} = args}) do
    # Route to all interested workers
    Oban.insert_all([
      user_notification_job(args),
      user_analytics_job(args),
      user_email_job(args)
    ])
  end
end</code></pre>

      <h3>2. Saga Pattern</h3>
      <p>For complex workflows across multiple apps:</p>
      <pre><code>defmodule OrderSaga.Worker do
  def perform(%{args: %{"step" => "reserve_inventory"}}) do
    case reserve_inventory() do
      :ok ->
        create_job(step: "charge_payment")
      :error ->
        create_job(step: "cancel_order")
    end
  end

  def perform(%{args: %{"step" => "charge_payment"}}) do
    # Next step in saga...
  end
end</code></pre>

      <h3>3. Priority Queues</h3>
      <p>Different queues for different priorities:</p>
      <pre><code>config :app_a, Oban,
  queues: [
    critical: 20,   # High concurrency
    default: 10,
    low_priority: 2
  ]

# Create job with specific queue
Oban.Job.new(%{task: "send_email"}, queue: :low_priority, worker: EmailWorker)</code></pre>

      <h3>4. Scheduled Jobs</h3>
      <p>Delay job execution:</p>
      <pre><code># Run in 1 hour
Oban.Job.new(
  %{reminder: "Meeting at 2pm"},
  worker: ReminderWorker,
  scheduled_at: DateTime.add(DateTime.utc_now(), 3600)
)</code></pre>

      <h2>Related Patterns</h2>
      <p>This architecture is related to several well-known patterns:</p>
      <ol>
        <li><strong>Event-Driven Architecture</strong>: Apps communicate through events (jobs)</li>
        <li><strong>Mediator Pattern</strong>: Oban mediates communication between apps</li>
        <li><strong>Command Pattern</strong>: Jobs encapsulate commands to be executed</li>
        <li><strong>Message Queue Pattern</strong>: Oban provides reliable message queuing</li>
        <li><strong>Saga Pattern</strong>: Can orchestrate complex multi-step workflows</li>
      </ol>

      <h2>Conclusion</h2>
      <p>Using Oban as an event bus in an Elixir umbrella project provides a powerful way to achieve loose coupling while maintaining the benefits of a monorepo. By sharing only a persistence layer and using Oban for asynchronous communication, applications can evolve independently while remaining part of a cohesive system.</p>

      <p>This pattern is particularly valuable as applications grow in complexity and teams need clear boundaries without the operational overhead of fully distributed microservices. It provides a middle ground: the organizational benefits of microservices with the deployment simplicity of a monolith.</p>

      <h2>References</h2>
      <ul>
        <li><a href="https://hexdocs.pm/oban" target="_blank" rel="noopener noreferrer">Oban Documentation</a></li>
        <li><a href="https://elixir-lang.org/getting-started/mix-otp/dependencies-and-umbrella-projects.html" target="_blank" rel="noopener noreferrer">Elixir Umbrella Projects</a></li>
        <li><a href="https://martinfowler.com/articles/201701-event-driven.html" target="_blank" rel="noopener noreferrer">Event-Driven Architecture</a></li>
        <li><a href="https://microservices.io/patterns/data/saga.html" target="_blank" rel="noopener noreferrer">Saga Pattern</a></li>
        <li><a href="https://github.com/alexandrubagu/oban_test_umbrella" target="_blank" rel="noopener noreferrer">Example Project on GitHub</a></li>
      </ul>

      <div class="mt-16 pt-8 border-t border-slate-300">
        <a href="/blog.html" class="inline-flex items-center gap-2 text-primary hover:underline font-medium">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
          </svg>
          Back to Blog
        </a>
      </div>
    </div>
  </article>

  <script>
    // Mobile menu toggle
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');

    mobileMenuBtn.addEventListener('click', () => {
      mobileMenu.classList.toggle('hidden');
    });
  </script>
</body>
</html>
